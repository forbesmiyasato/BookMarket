{% extends "layout.html" %}
{% block content %}
<!-- Start Banner Area -->
<section class="banner-area organic-breadcrumb">
    <div class="container">
        <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
            <div class="col-first">
                <h1>Shop page</h1>
                <nav class="d-flex align-items-center">
                    <a href="{{url_for('home')}}">Home<span class="lnr lnr-arrow-right"></span></a>
                    <a href="">Shop</span></a>
                </nav>
            </div>
        </div>
    </div>
</section>
<!-- End Banner Area -->
<div class="container">
    <div class="row">
        <div class="col-xl-3 col-lg-4 col-md-5">
            <div class="sidebar-categories">
                <div class="head">Browse Categories</div>
                <ul class="main-categories">
                    {% for department in departments %}
                    <li class="main-nav-list">
                        <a aria-expanded="false" {% if department.classes|length > 0 %}data-toggle="collapse"
                            href="#nav{{department.id}}" {% endif %} aria-controls="{{department_id}}"><span
                                class="lnr lnr-arrow-right"></span>
                            {{department.department_name}}<span class="number">(53)</span>
                        </a>
                        <ul class="collapse" id="nav{{department.id}}" data-toggle="collapse" aria-expanded="false"
                            aria-controls="{{department_id}}">
                            <li class="main-nav-list child"><a
                                    href="{{url_for('items_for_department', department_id=department.id)}}">All in
                                    {{department.department_name}}<span class="number">#</span></a>
                            </li>
                            {% for class in department.classes %}
                            <li class="main-nav-list child"><a
                                    href="{{url_for('items_for_class', class_id=class.id)}}">{{class.class_name}}<span
                                        class="number">#</span></a>
                            </li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="col-xl-9 col-lg-8 col-md-7">
            <!-- Start Filter Bar -->
            <div class="filter-bar d-flex flex-wrap align-items-center">
                <div class="sorting">
                    <select>
                        <option value="1">Sort By</option>
                        <option value="2">Oldest to Newest</option>
                        <option value="3">Default sorting</option>
                    </select>
                </div>
                <div class="sorting mr-auto">
                    <select>
                        <option value="1">Show 12</option>
                        <option value="1">Show 12</option>
                        <option value="1">Show 12</option>
                    </select>
                </div>
                <div class="pagination">
                    <a href="#" class="persist-link prev-arrow"><i class="fa fa-long-arrow-left"
                            aria-hidden="true"></i></a>
                    {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                    {% if page_num %}
                    {% if posts.page == page_num %}
                    <a class="persist-link active" rel="keep-params" href="{{url_for('shop', page=page_num)}}">
                        {{page_num}} </a>
                    {% else %}
                    <a href="{{url_for('shop', page=page_num)}}" class="persist-link"> {{page_num}} </a>
                    {% endif %}
                    {% else %}
                    <a class="dot-dot"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></a>
                    {% endif %}
                    {% endfor %}
                    <a href="#" class="persist-link next-arrow"><i class="fa fa-long-arrow-right"
                            aria-hidden="true"></i></a>
                </div>
            </div>
            <!-- End Filter Bar -->
            <!-- Start Best Seller -->
            <section class="lattest-product-area pb-40 category-list">
                <div class="row">
                    {% for post in posts.items %}
                    <!-- single product -->
                    <div class="col-lg-4 col-md-6">
                        <div class="single-product">
                            <img class="img-fluid" src="{{url_for('static', filename='item_pics/' + post.thumbnail)}}"
                                alt="">
                            <div class="product-details">
                                <h6><a href="{{url_for('item', item_id=post.id)}}">{{post.name}}</a></h6>
                                <div class="price">
                                    <h6>{{post.price}}</h6>
                                </div>
                                <div class="prd-bottom">

                                    <a href="" class="social-info">
                                        <span class="ti-bag"></span>
                                        <p class="hover-text">add to bag</p>
                                    </a>
                                    <a href="" class="social-info">
                                        <span class="lnr lnr-heart"></span>
                                        <p class="hover-text">Wishlist</p>
                                    </a>
                                    <a href="" class="social-info">
                                        <span class="lnr lnr-sync"></span>
                                        <p class="hover-text">compare</p>
                                    </a>
                                    <a href="" class="social-info">
                                        <span class="lnr lnr-move"></span>
                                        <p class="hover-text">view more</p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            <!-- End Best Seller -->
            <!-- Start Filter Bar -->
            <div class="filter-bar d-flex flex-wrap align-items-center">
                <div class="sorting mr-auto">
                    <select>
                        <option value="1"><a href="{{url_for('shop', per_page=6)}}" class="persist-link">Show 6</a>
                        </option>
                        <option value="2">Show 12</option>
                        <option value="3">Show 24</option>
                    </select>
                </div>
                <div class="pagination">
                    <a href="#" class="persist-link prev-arrow"><i class="fa fa-long-arrow-left"
                            aria-hidden="true"></i></a>
                    {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                    {% if page_num %}
                    {% if posts.page == page_num %}
                    <a class="persist-link active" href="{{url_for('shop', page=page_num)}}"> {{page_num}} </a>
                    {% else %}
                    <a href="{{url_for('shop', page=page_num)}}" class="persist-link"> {{page_num}} </a>
                    {% endif %}
                    {% else %}
                    <a class="dot-dot"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></a>
                    {% endif %}
                    {% endfor %}
                    <a href="#" class="persist-link next-arrow"><i class="fa fa-long-arrow-right"
                            aria-hidden="true"></i></a>
                </div>
            </div>
        </div>
        <!-- End Filter Bar -->
    </div>
</div>
</div>

<!-- Start related-product Area -->
<section class="related-product-area section_gap">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6 text-center">
                <div class="section-title">
                    <h1>Deals of the Week</h1>
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut
                        labore et dolore
                        magna aliqua.</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-9">
                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-6 mb-20">
                        <div class="single-related-product d-flex">
                            <a href="#"><img src="img/r1.jpg" alt=""></a>
                            <div class="desc">
                                <a href="#" class="title">Black lace Heels</a>
                                <div class="price">
                                    <h6>$189.00</h6>
                                    <h6 class="l-through">$210.00</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="ctg-right">
                    <a href="#" target="_blank">
                        <img class="img-fluid d-block mx-auto" src="img/category/c5.jpg" alt="">
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    function getParameterByName(name) {
        var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
        return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
    }

    $('document').ready(function () {
        var persistedQueryParam = getParameterByName('per_page');

        if (persistedQueryParam && persistedQueryParam.length > 0) {
            $('a.persist-link').each(function () {
                var elem = $(this);
                var href = elem.attr('href');
                elem.attr('href', href + (href.indexOf('?') != -1 ? '&' : '?') + 'per_page=' + persistedQueryParam);
            });
        }

        var persistedQueryParam = getParameterByName('order');

        if (persistedQueryParam && persistedQueryParam.length > 0) {
            $('a.persist-link').each(function () {
                var elem = $(this);
                var href = elem.attr('href');
                elem.attr('href', href + (href.indexOf('?') != -1 ? '&' : '?') + 'order=' + persistedQueryParam);
            });
        }
    });

    document.addEventListener('DOMContentLoaded', function (event) {
        var options = document.getElementsByClassName('option');
        var a = document.createElement("a");
        //set date descending sort for front end
        a.textContent = "Newest to Oldest";
        var url = "{{url_for('items_for_department', department_id=department,order = 'desc', per_page = request.args.get('per_page'))}}"
        .replace('&amp;', '&')
        options[0].innerHTML = "";
        a.setAttribute('href', url);
        a.setAttribute('style', 'color:rgb(119, 119, 119)')
        a.setAttribute('class', 'persist-link li-link')
        options[0].appendChild(a);

        //set date ascending sort for front end
        var b = document.createElement("a");
        b.textContent = options[1].innerHTML;
        options[1].innerHTML = "";
        var url = "{{url_for('items_for_department', department_id=department, order = 'asc', per_page = request.args.get('per_page'))}}"
        .replace('&amp;', '&')
        b.setAttribute('href', url);
        b.setAttribute('style', 'color:rgb(119, 119, 119)')
        b.setAttribute('class', 'persist-link li-link')
        options[1].appendChild(b);

        // //set date ascending sort for front end
        // var b = document.createElement("a");
        // b.textContent = options[1].innerHTML;
        // options[1].innerHTML = "";
        // var url = "{{url_for('shop', order='asc', per_page=request.args.get('per_page'))}}".replace('&amp;','&')
        // b.setAttribute('href', url);
        // b.setAttribute('style', 'color:rgb(119, 119, 119)')
        // b.setAttribute('class', 'persist-link li-link')
        // options[1].appendChild(b);

        for (var i = 2; i < options.length; i++) {
            console.log(options[i]);
        }
    });
</script>
<!-- End related-product Area -->
{% endblock content %}