<!DOCTYPE html>
<html>

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">

  <!-- Mobile Specific Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- Favicon-->
  <link rel="shortcut icon" href="{{ url_for('static', filename='img/fav.png')}}">
  <!-- Author Meta -->
  <meta name="Forbes" content="">
  <!-- Meta Description -->
  <meta name="Books advertisement website for universities" content="">
  <!-- Meta Keyword -->
  <meta name="books, advertisement" content="">
  <!-- meta character set -->
  <meta charset="UTF-8">
  <!-- Site Title -->
  {% if title %}
  <title>Bookstore - {{title}}</title>
  {% else %}
  <title>Bookstore</title>
  {% endif %}

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='/main.css')}}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='/css/main.css')}}">
  <!-- From Karma -->
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/linearicons.css')}}">
  <!-- <link rel="stylesheet" href="{{ url_for('static', filename='/css/font-awesome.min.css')}}"> -->
  <script src="https://kit.fontawesome.com/58d8160f79.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/themify-icons.css')}}">
  <!-- <link rel="stylesheet" href="{{ url_for('static', filename='/css/bootstrap.css')}}"> -->
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/owl.carousel.css')}}">
  <!-- <link rel="stylesheet" href="{{ url_for('static', filename='/css/nice-select.css')}}"> -->
  <!-- <link rel="stylesheet" href="{{ url_for('static', filename='/css/nouislider.min.css')}}">
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/ion.rangeSlider.css')}}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/ion.rangeSlider.skinFlat.css')}}" /> -->
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/magnific-popup.css')}}">
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/main.css')}}">
  <script src="{{ url_for('static', filename='js/vendor/jquery-2.2.4.min.js')}}"></script>

  <!-- font -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
  <link href="{{ url_for('static', filename='fileuploader/dist/font/font-fileuploader.css')}}" media="all"
    rel="stylesheet">

  <!-- css -->
  <link href="{{ url_for('static', filename='fileuploader/dist/jquery.fileuploader.min.css')}}" media="all"
    rel="stylesheet">
  <link
    href="{{ url_for('static', filename='fileuploader/examples/thumbnails/css/jquery.fileuploader-theme-thumbnails.css')}}"
    media="all" rel="stylesheet">


  <!-- js -->
  <!-- <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script> -->

  <script src="{{ url_for('static', filename='fileuploader/dist/jquery.fileuploader.min.js')}}"
    type="text/javascript"></script>

  <!-- selectize -->
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.min.js"
    integrity="sha256-+C0A5Ilqmu4QcSPxrlGpaZxJ04VjsRjKu+G82kl5UJk=" crossorigin="anonymous"></script>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.bootstrap3.min.css"
    integrity="sha256-ze/OEYGcFbPRmvCnrSeKbRTtjG4vGLHXgOqsyLFTRjg=" crossorigin="anonymous" />

  <!-- bootstrap-select -->
  <!-- Latest compiled and minified CSS -->
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.15/dist/css/bootstrap-select.min.css"> -->

  <!-- Latest compiled and minified JavaScript -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.15/dist/js/bootstrap-select.min.js"></script> -->
  <script src="{{ url_for('static', filename='js/owl.carousel.min.js')}}"></script>
  <script src="{{ url_for('static', filename='js/shop.js')}}"></script>

  <!-- toastr -->
  <link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

</head>

<body>
  <!-- Start Header Area -->
  <header id="sticky" class="header_area sticky-header">
    <div class="main_menu">
      <nav class="navbar navbar-expand-lg navbar-light main_box">
        <div class="container">
          <!-- Brand and toggle get grouped for better mobile display -->
          <a class="navbar-brand logo_h" href="{{ url_for('home')}}"><img
              src="{{ url_for('static', filename='img/logo.png')}}" alt=""></a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse offset" id="navbarSupportedContent">
            <ul class="nav navbar-nav menu_nav ml-auto">
              <li class="nav-item"><a id="home" class="nav-link activable {% if title == 'Home' %}active{% endif %}"
                  onclick="linkClicked(this, '{{ url_for('home')}}')">Home</a></li>
              <li class="nav-item"><a id="shop" class="nav-link activable {% if title == 'Shop' %}active{% endif %}"
                  onclick="linkClicked(this, '{{ url_for('shop_api.shop')}}')">shop</a></li>
              {% if current_user.is_authenticated %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('userAuth.logout')}}">Logout</a></li>
              <li class="nav-item submenu dropdown">
                <a href="#" id="user" class="nav-link activable dropdown-toggle 
                {% if (title == 'listings' or title == 'account' or title == 'saved') %}active{% endif %}"
                  data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">User</a>
                <ul class="dropdown-menu">
                  <li class="nav-item"><a class="nav-link activable"
                      onclick="linkClicked(this, '{{ url_for('account')}}')">Account</a></li>
                  <li class="nav-item"><a class="nav-link activable"
                      onclick="linkClicked(this, '{{ url_for('listings')}}')">Listings</a></li>
                  <li class=" nav-item"><a class="nav-link"
                      onclick="linkClicked(this, '{{ url_for('saved_for_later')}}')">Saved</a></li>
                </ul>
              </li>
              {% else %}
              <li class=" nav-item"><a id="login" class="nav-link activable {% if title == 'Login' %}active{% endif %}"
                  onclick="linkClicked(this, '{{ url_for('userAuth.login')}}')">Login</a></li>
              <li class="nav-item"><a id="register"
                  class="nav-link activable {% if title == 'Register' %}active{% endif %}"
                  onclick="linkClicked(this, '{{ url_for('userAuth.register')}}')">Register</a></li>
              {% endif %}
              <li class="nav-item"><a id="sell" class="nav-link activable {% if title == 'Sell' %}active{% endif %}"
                  onclick="linkClicked(this, '{{ url_for('new_item')}}')">Sell</a></li>
            </ul>
            <ul class=" nav navbar-nav navbar-right">
              <li class="nav-item"><a id="shopping-cart"
                  onclick="linkClicked(this, '{{ url_for('saved_for_later')}}?cart')"
                  class="cart activable {% if title == 'Saved?cart' %}active{% endif %}">
                  <span class="ti-bag"><span class="bag-icon">{{ numItems|length }}</span></span></a></li>
              <li class="nav-item">
                <button class="search"><span class="lnr lnr-magnifier" id="search"></span></button>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
    <div class="search_input" id="search_input_box">
      <div class="container-wrapper">
        <div class="container">
          <form class="d-flex justify-content-between" id="search_form">
            <input type="text" class="form-control" id="search_input" placeholder="Search Here">
            <button type="submit" class="btn"></button>
            <span class="lnr lnr-cross" id="close_search" title="Close Search"></span>
          </form>
        </div>
      </div>
    </div>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <script>
      toastr.options = { "positionClass": {% if message == 'Logged in!' or message == 'Logged out!' %} "toast-top-left" {% else %} "toast-top-center" {% endif %}
      , "closeButton": true, "timeOut": "6000" }
      toastr.{{category}}("{{message}}");
    </script>
    {% endfor %}
    {% endif %}
    {% endwith %}
  </header>
  <!-- End Header Area -->
  <div class="overlay">
    <div class="loader">Loading...</div>
    <h3 class="loader-text" id="loader-text">Loading...</h3>
  </div>

  <div id="block-content">
    {% block content %}
    {% endblock %}
  </div>

  <!-- start footer Area -->
  <footer class="footer-area section_gap">
    <div class="container">
      <div class="row">
        <div class="col-lg-3  col-md-6 col-sm-6">
          <div class="single-footer-widget">
            <h6>Bookmark<span class="it">it</span></h6>
            <p>
              <a class="footer-item" onclick="linkClicked(this, '{{url_for('about_us')}}')">About Us</a>
            </p>
            <p style="font-size: 16px">
              Made by Forbes & Thomas
            </p>
            <!-- <p>
              <a class="footer-item"href ="{{url_for('about_us')}}">Meet the founders</a>
            </p> -->
          </div>
        </div>
        <div class="col-lg-2 col-md-6 col-sm-6">
          <div class="single-footer-widget">
            <h6>Contact <span class="it">Us</span></h6>
            <p>
              <a class="footer-item" href="{{url_for('about_us')}}">Leave a Message</a>
            </p>
            <p style="font-size: 16px">
              forbesmiyasato@yahoo.com
            </p>
            <div class="footer-social d-flex align-items-center">
              <a href="https://www.linkedin.com/in/forbesmiyasato/"><i class="fa fa-linkedin"></i></a>
              <a href="https://github.com/forbesmiyasato"><i class="fa fa-github"></i></a>
              <a href="https://www.instagram.com/forbesmiyasato/"><i class="fa fa-instagram"></i></a>
              <a href="#"><i class="fa fa-facebook"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- End footer Area -->
  <!-- Optional JavaScript -->
  <script>
    search_form = document.getElementById('search_form');
    function search(event) {
      event.preventDefault();
      search_input = document.getElementById('search_input').value;
      console.log(search_input);
      // window.location = '/shop?search=' + search_input;
      const searchDropdown = $('.search_input')[0]
      if (searchDropdown) {
        searchDropdown.style.display = 'none'
      }

      linkClicked(document.getElementById('shop'), `/shop?search=${search_input}`, search_input)
    }

    search_form.addEventListener("submit", search);

    // const shopClicked = (url) => {
    //   console.log(url)
    //   history.pushState(null, '11', url)
    //   $.ajax({
    //     url: url,
    //     type: "get",
    //     data: null,
    //     success: function (response) {
    //       $('#block-content').html(response);
    //     }
    //   })
    // }

    let active = document.getElementsByClassName('activable active')[0];
    let prevActive

    let home_html = null;
    let login_html = null;
    let register_html = null;
    let about_html = null;
    let shop_html = null;

    var call;
    const linkClicked = (ele, url, search_input) => {
      console.log(url);
      if (document.documentElement.clientWidth < 992) {
        navbarCollapse();
      }

      highlightNavLink()
      //collapse user menu on click
      const userDropdown = $('.dropdown-toggle')
      if (userDropdown) {
        $('.dropdown-toggle').dropdown('toggle')
      }

      console.log(active)
      console.log(ele)
      if (active) {
        active.classList.remove('active');
      }
      if (!ele.classList.contains('footer-item')) {
        prevActive = active;
        if (url === '/saved?cart') {
          let cart = document.getElementById('shopping-cart');
          cart.classList.add('active')
          active = cart
        }
        else if (url === '/listings' || url === '/account' || url === '/saved') {
          let user = document.getElementById('user');
          user.classList.add('active')
          active = user;
        } else {
          ele.classList.add('active');
          active = ele;
        }
      }

      let alerts1 = document.getElementsByClassName('alert');
      console.log(alerts1);
      console.log(ele.id)
      if (call) call.abort()
      history.pushState({ element: ele.id }, null, url)
      if (url === '/home' && home_html) {
        $('#block-content').html(home_html);
      } else if (url ==='/login' && login_html) {
        $('#block-content').html(login_html);
      } else if (url ==='/register' && register_html) {
        $('#block-content').html(register_html);
      } else if (url ==='/shop' && shop_html) {
        $('#block-content').html(shop_html);
      } else if (url ==='/aboutus' && about_html) {
        $('#block-content').html(about_html);
      } else {
      call = $.ajax({
        url: url,
        type: "get",
        data: { standalone: 'true' },
        async: true,
        success: function (response) {
          if (url === '/home' && !home_html) {
            home_html = response
          } else if (url === '/register' && !register_html) {
            register_html = response
          } else if (url === '/login' && !login_html) {
            login_html = response
          } else if (url === '/shop' && !shop_html) {
            shop_html = response
          } else if (url === '/aboutus' && !about_html) {
            about_html = response
          }
          if (response.state) {
            toastr.options = { "positionClass": "toast-top-center", "closeButton": true }
            if (response.state === 'login-required') {
              toastr.info("You must sign in before selling!");
            } else if (response.state === 'confirm-required') {
              toastr.info("You must confirm your email address before selling!");
            } else if (response.state === 'max-listings') {
              toastr.error("There is a max of 10 listings at a time! Please wait or delete listings before selling.");
            }
            $('#block-content').html(response.html);
          } else {
            $('#block-content').html(response);
          }
        },
        beforeSend: function () {
          let loadText = "Loading..."
          if (search_input) {
            loadText = `Finding items with "${search_input}" in it's title`;
          }
          $("body").toggleClass("loading");
          $("#loader-text").html(loadText)
        },
        complete: function () {
          $("body").toggleClass("loading");
          $("#loader-text").html('Loading...')
        }
      })
    }
      $(window).scrollTop(0);
      // $('#block-content').load(url + "?standalone=true")
    }

    window.addEventListener('popstate', (event) => {
      console.log(active)
      console.log(event)
      highlightNavLink()
      if (active) {
        active.classList.remove('active');
      }
      // if (event.state) {
      //   prevActive = document.getElementById(event.state.element);
      //   prevActive.classList.add('active');
      // } else {
      //   prevActive = document.getElementById('home').classList.add('active');
      // }
      // active = prevActive;
      let path = (window.location.pathname + location.search).split('/')[1];
      console.log(path)
      if (path === 'saved?cart') {
        active = document.getElementById('shopping-cart');
      } else if (path === 'listings' || path === 'account' || path === 'saved') {
        active = document.getElementById('user');
      } else if (path === 'item') {
        active = document.getElementById('sell');
      } else {
        active = document.getElementById(path);
      }
      if (active) {
        active.classList.add('active');
      }

      console.log(location.href)
      $.ajax({
        url: location.href,
        type: "get",
        data: { standalone: 'true' },
        async: true,
        success: function (response) {
          if (response.state) {
            toastr.options = { "positionClass": "toast-top-center", "closeButton": true }
            if (response.state === 'login-required') {
              toastr.info("You must sign in before selling!");
            } else if (response.state === 'confirm-required') {
              toastr.info("You must confirm your email address before selling!");
            } else if (response.state === 'max-listings') {
              toastr.error("There is a max of 10 listings at a time! Please wait or delete listings before selling.");
            }
            $('#block-content').html(response.html);
          } else {
            $('#block-content').html(response);
          }
          highlightNavLink()
        },
        beforeSend: function () {
          $("body").toggleClass("loading");
        },
        complete: function () {
          $("body").toggleClass("loading");
          // if (path === 'shop') {
          //   initializeShopPage();
          // }
        }
      })
    });

    const navbarCollapse = () => {
      if ($('#navbarSupportedContent')[0].classList.contains('show') === true) {
        $('.navbar-collapse').collapse("toggle")
      }
    }

    // $(document).on({
    //   ajaxStart: function () {
    //     $("body").toggleClass("loading");
    //   },
    //   ajaxStop: function () {
    //     $("body").toggleClass("loading");
    //   }
    // });
    // $(window).on('popstate', function (event) {
    //   // location.reload();
    //   console.log(event.state)
    //   console.log(event)
    //   console.log(prevActive)
    //   console.log(active)
    //   $.ajax({
    //     url: location.href,
    //     type: "get",
    //     data: { standalone: 'true' },
    //     async: true,
    //     success: function (response) {
    //       $('#block-content').html(response);
    //     }
    //   })
    // });
  </script>
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <!-- <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
    crossorigin="anonymous"></script>

  <!-- FROM KArMA -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
    integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
    crossorigin="anonymous"></script>
  <!-- <script src="{{ url_for('static', filename='js/vendor/bootstrap.min.js')}}"></script> -->
  <script src="{{ url_for('static', filename='js/jquery.ajaxchimp.min.js')}}"></script>
  <!-- <script src="{{ url_for('static', filename='js/jquery.nice-select.min.js')}}"></script> -->
  <script src="{{ url_for('static', filename='js/jquery.sticky.js')}}"></script>
  <script src="{{ url_for('static', filename='js/nouislider.min.js')}}"></script>
  <!-- <script src="{{ url_for('static', filename='js/countdown.js')}}"></script> -->
  <script src="{{ url_for('static', filename='js/jquery.magnific-popup.min.js')}}"></script>
  <!--gmaps Js-->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script>
  <!-- <script src="{{ url_for('static', filename='js/gmaps.min.js')}}"></script> -->
  <script src="{{ url_for('static', filename='js/main.js')}}"></script>
</body>

</html>