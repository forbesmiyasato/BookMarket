{% block body_content %}

<div class="container {{'mt-3' if legend == 'New'}}">
    <div class="content-section">
        <form method="POST" action="" enctype="multipart/form-data">
            {{form.hidden_tag()}}
            <fieldset class="form-group">
                <legend class="border-bottom mb-4">
                    {{legend}} Post
                </legend>
                <div class="form-group">
                    {{ form.name.label(class="form-control-label") }}
                    {% if form.name.errors %}
                    {{ form.name(class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.name.errors %}
                        <span>{{error}}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.name(class="form-control form-control-lg") }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.description.label(class="form-control-label") }}
                    {% if form.description.errors %}
                    {{ form.description(class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.description.errors %}
                        <span>{{error}}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.description(class="form-control form-control-lg") }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.price.label(class="form-control-label") }}
                    {% if form.price.errors %}
                    {{ form.price(class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.price.errors %}
                        <span>{{error}}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.price(class="form-control form-control-lg") }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.item_department.label(class="form-control-label") }}
                    {% if form.item_department.errors %}
                    {{ form.item_department(id="department", class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.item_department.errors %}
                        <span>{{error}}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div>
                        {{ form.item_department(id="department", class="form-control form-control-sm") }}
                    </div>
                    {% endif %}
                </div>
                <br style="clear: both" />
                <div class="form-group">
                    {{ form.item_class.label(class="form-control-label") }}
                    {% if form.item_class.errors %}
                    {{ form.item_class(id="class", class="form-control form-control-lg is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.item_class.errors %}
                        <span>{{error}}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div>
                        {{ form.item_class(id="class", class="form-control form-control-sm") }}
                    </div>
                    {% endif %}
                </div>
                <br style="clear: both" />
            
                
                <div class="form-group">
                    {{ form.files.label(class="form-control-label") }}
                    {% if form.files.errors %}
                    {{ form.files(class="form-control-file is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.files.errors %}
                        <span>{{error}}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div>
                        {{ form.files(class="files form-control-file") }}
                    </div>
                    {% endif %}
                </div>

            </fieldset>
            <div class="form-group">
                {{ form.submit(class="btn btn-outline-info", onclick="history.replaceState(null, null, ' ');")}}
            </div>
        </form>
    </div>
</div>

<script>
    let department_select = document.getElementById('department');
    let class_select = document.getElementById('class');

    class_select.required = true;
    department_select.required = true;

    department_select.selectedIndex = -1;
    department_select.onchange = function () {
        department = department_select.value;

        fetch('/class/' + department).then(function (response) {
            response.json().then(function (data) {
                let optionHTML = '';
                // optionHTML += '<option data-display="Select Class">Select</option>'
                for (let item_class of data.classes) {
                    optionHTML += '<option value="' + item_class.id + '">'
                        + item_class.class_name + '</option>';
                }
                class_select.innerHTML = optionHTML;
                $('select').niceSelect('update');
            })
        });
    }
</script>

<script type="text/javascript">
    $(document).ready(function () {
        $('input.files').fileuploader({	
            theme: 'default',	
            limit: 9,	
            // files: [{	
            //     "name": "test1",	
            //     "type": "image\/jpeg",	
            //     "size": 5100000,	
            //     "file": "https://book-advertisement-site.s3-us-west-2.amazonaws.com/e8085b0f9d9778c8.jpg",	
            //     "data": {	
            //         "thumbnail": "https://book-advertisement-site.s3-us-west-2.amazonaws.com/e8085b0f9d9778c8.jpg",	
            //         "readerForce":true	
            //     }	
            // }]	
        });
    });
</script>
{% endblock %}