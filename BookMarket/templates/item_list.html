{% block body_content %}
<section class="lattest-product-area pb-40 category-list">
    <div class="text-center mt-5 mb-5" id="posts-spinner">
        <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    {% if posts.total == 0 %}
<div class="container no-results mt-5">
    <h1 class="pt-3 pb-3">Sorry there's no books that meet your search criteria at this moment</h1>
</div>
{% else %}
    <div class="row" id="items-list">
        {% for post in posts.items %}
        <!-- single product -->
        <div class="col-lg-4 col-md-6">
            <div class="single-product">
                <img class="img-thumbnail list-image"
                    src="https://book-advertisement-site.s3-us-west-2.amazonaws.com/{{post.thumbnail}}" alt="">
                <div class="product-details">
                    <h6 class="hover-line"><a href="{{url_for('shop_api.item', item_id=post.id)}}">{{post.name}}</a>
                    </h6>
                    <div class="price">
                        <h6>{{post.price}}</h6>
                    </div>
                    <div class="prd-bottom">
                        <a href="{{url_for('shop_api.item', item_id=post.id)}}" class="social-info">
                            <span class="lnr lnr-move"></span>
                            <p class="hover-text">View more</p>
                        </a>
                        {% if current_user.id == post.user_id %}
                        <a data-toggle="modal" data-target="#deleteModal{{loop.index}}" href="javascript:void(0)"
                            class="social-info">
                            <span class="lnr lnr-trash"></span>
                            <p class="hover-text">Delete</p>
                        </a>
                        {% else %}
                        <a onclick="addToBag(this, {{post.id}}, {{current_user.id}})" href="javascript:void(0)"
                            class="social-info">
                            <span class="ti-bag"></span>
                            <p class="hover-text">Add to bag</p>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="deleteModal{{loop.index}}" tabindex="-1" role="dialog"
            aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Delete Post?</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <!-- <div class="modal-body">
      Are you sure you want to delete the post?
    </div> -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <form action="{{url_for('delete_item', item_id=post.id)}}" method="POST">
                            <input type="submit" class="btn btn-danger" value="Delete">
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</section>

<script>
    function addToBag(ele, item_id, user_id) {
        let text = ele.children[1]
        text.innerHTML = 'Added!'
        var url = "{{url_for('add_to_bag', item='tempItem', user='tempUser')}}"
            .replace('tempItem', item_id).replace('tempUser', user_id).replace('&amp;', '&')

        $.post(url, null, (data, status) => {
            if (data.added) {
                let bagIcon = document.getElementsByClassName("bag-icon")[0];
                bagIcon.innerHTML = parseInt(bagIcon.innerHTML) + 1;
            }
        })
    }
</script>
{% endblock %}